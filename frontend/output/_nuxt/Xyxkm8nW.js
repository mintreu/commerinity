import{b4 as U,bd as h,by as H,aY as f,a_ as u,b5 as e,bg as B,b8 as k,aZ as V,bc as X,aX as F,bi as A,br as R,aW as j,b9 as o,ba as D,bk as q,bl as T,bm as C,be as Z,bf as J,bo as I,bC as K,bA as Q,bj as ee,bB as te,bE as se}from"./B132AJ_X.js";import{A as ae}from"./C9GpPXXW.js";import{u as L}from"./DVwEWGMy.js";import{C as oe}from"./ry3H8mcT.js";import{s as re}from"./BjZ6Woku.js";import"./KQNRGUnb.js";import"./B4utk0fH.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};d.SENTRY_RELEASE={id:"3703708ef9ac1b45e23fc2a6a145a79341d4c60a"}}catch{}})();try{(function(){var d=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},g=new d.Error().stack;g&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[g]="45baccdc-53a5-4cb4-8aca-d75199de171c",d._sentryDebugIdIdentifier="sentry-dbid-45baccdc-53a5-4cb4-8aca-d75199de171c")})()}catch{}const le=["for"],ie={class:"relative"},de=["id","type","autocomplete","value","aria-invalid"],ne={key:0,class:"form-error"},ue=U({__name:"PasswordField",props:{label:{type:String,required:!0},modelValue:{type:String,required:!0},field:{type:String,required:!0},error:{type:[String,null],default:null},autocomplete:{type:String,default:"new-password"}},emits:["update:modelValue","clearError"],setup(d,{emit:g}){const x=d,y=g,_=h(!1),a=H(()=>`password-${x.field}`);function s(){_.value=!_.value}function c(n){const b=n.target.value;y("update:modelValue",b),y("clearError",x.field)}return(n,b)=>{const v=X;return u(),f("div",null,[e("label",{for:a.value,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},k(d.label),9,le),e("div",ie,[e("input",{id:a.value,type:_.value?"text":"password",autocomplete:d.autocomplete,value:d.modelValue,onInput:b[0]||(b[0]=l=>c(l)),class:"form-input pr-10","aria-invalid":d.error?"true":"false"},null,40,de),e("button",{type:"button",class:"absolute right-3 top-2.5 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",onClick:s,"aria-label":"Toggle password visibility"},[V(v,{name:_.value?"mdi:eye-off":"mdi:eye"},null,8,["name"])])]),d.error?(u(),f("p",ne,k(d.error),1)):B("",!0)])}}}),N=F(ue,[["__scopeId","data-v-84495c3c"]]),ce={class:"bg-white dark:bg-gray-800 shadow rounded-xl mt-10"},me={class:"grid grid-cols-1 md:grid-cols-[250px_1fr] divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700"},pe={class:"p-6 space-y-6"},fe={class:"space-y-4"},ve={class:"flex flex-row"},ge=["disabled"],ye=U({__name:"ChangePassword",emits:["success"],setup(d,{emit:g}){var b;const x=A(),y=g,{refreshUser:_}=R(),a=j();if(!((b=a.public)!=null&&b.apiBase))throw new Error("Missing runtime config: public.apiBase is required for API calls");const s=L("put",`${a.public.apiBase}/account/password`,{current_password:"",password:"",password_confirmation:""});function c(v){s.forgetError?s.forgetError(v):s.errors&&v in s.errors&&delete s.errors[v]}async function n(){var v,l,i,t,m,w,E;if(s.errors={},!s.current_password||s.current_password.length<6){s.errors.current_password="Please enter your current password (min 6 chars).";return}if(!s.password||s.password.length<8){s.errors.password="New password must be at least 8 characters.";return}if(s.password!==s.password_confirmation){s.errors.password_confirmation="Passwords do not match.";return}try{await s.submit(),await(_==null?void 0:_()),y("success"),(v=s.reset)==null||v.call(s),x.success({title:"Success!",message:"Your password has been updated successfully."})}catch(S){const O=((i=(l=S==null?void 0:S.response)==null?void 0:l.data)==null?void 0:i.message)||((E=(w=(m=(t=S==null?void 0:S.response)==null?void 0:t.data)==null?void 0:m.errors)==null?void 0:w.current_password)==null?void 0:E[0])||"Failed to update password. Please try again.";x.error({title:"Error!",message:O}),console.log("Password update failed:",O)}}return(v,l)=>(u(),f("div",ce,[e("div",me,[l[4]||(l[4]=e("div",{class:"p-6"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"}," Change Password "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Use a strong and unique password to secure your account. ")],-1)),e("div",pe,[e("div",fe,[V(N,{label:"Current Password",modelValue:o(s).current_password,"onUpdate:modelValue":l[0]||(l[0]=i=>o(s).current_password=i),field:"current_password",error:o(s).errors.current_password,autocomplete:"current-password",onClearError:c},null,8,["modelValue","error"]),V(N,{label:"New Password",modelValue:o(s).password,"onUpdate:modelValue":l[1]||(l[1]=i=>o(s).password=i),field:"password",error:o(s).errors.password,autocomplete:"new-password",onClearError:c},null,8,["modelValue","error"]),V(N,{label:"Confirm Password",modelValue:o(s).password_confirmation,"onUpdate:modelValue":l[2]||(l[2]=i=>o(s).password_confirmation=i),field:"password_confirmation",error:o(s).errors.password_confirmation,autocomplete:"new-password",onClearError:c},null,8,["modelValue","error"])]),e("div",ve,[l[3]||(l[3]=e("div",{class:"grow hidden md:block"},null,-1)),e("button",{type:"button",class:"btn-primary",disabled:o(s).processing,onClick:n},k(o(s).processing?"Updating...":"Update Password"),9,ge)])])])]))}}),be=F(ye,[["__scopeId","data-v-0b7ae86d"]]),we={class:"grid grid-cols-1 md:grid-cols-[250px_1fr] divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700"},xe={class:"p-4 space-y-6"},_e={key:0,class:"form-error"},he={key:0,class:"flex justify-end"},ke=["disabled"],Ee={key:1,class:"flex flex-col items-center w-full"},$e={class:"flex justify-center gap-2 mt-2 flex-wrap"},Se=["onUpdate:modelValue","onInput"],Pe={key:0,class:"form-error mt-2"},Be=["disabled"],Ve={key:2,class:"text-center mt-4"},Te=["disabled"],Ie=U({__name:"ChangeEmail",setup(d){const g=A(),x=j(),{user:y,refreshUser:_}=R(),a=h(""),s=h(["","","","","",""]),c=h(!1),n=h(!1),b=h(!1),v=h(!1),l=h(!1),i=h(60);let t=null;const m=h(""),w=h(""),E=h(!1);let S="";D(()=>{var p;(p=y.value)!=null&&p.email&&(a.value=y.value.email,S=y.value.email)});async function O(){const p=a.value.trim();if(p===S){c.value=!1,n.value=!1,w.value="",E.value=!1;return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)){m.value="Enter a valid email address",E.value=!1;return}m.value="",c.value=!1,n.value=!1,w.value="";try{const $=await I(`${x.public.apiBase}/auth/has_contact`,{method:"POST",body:{type:"email",value:p}});E.value=!$.data.exists,$.data.exists&&(m.value="Email already in use")}catch{m.value="Failed to check email",E.value=!1}}function Y(p,r){if(r.inputType!=="deleteContentBackward"){const $=r.target.nextElementSibling;$&&$.focus()}}async function W(){var p;w.value="",n.value=!1,b.value=!0;try{await I(`${x.public.apiBase}/auth/send-otp`,{method:"POST",body:{type:"email",value:a.value.trim()}}),c.value=!0,E.value=!1,i.value=60,t=re(()=>{i.value--,i.value<=0&&(clearInterval(t),E.value=!0,b.value=!1)},1e3),g.info({title:"OTP Sent",message:"A 6-digit OTP has been sent to your email."})}catch(r){w.value=((p=r==null?void 0:r.data)==null?void 0:p.message)||"Failed to send OTP",b.value=!1,g.error({title:"Error",message:w.value})}}async function z(){var r,$;const p=s.value.join("");if(p.length!==6){w.value="Enter 6-digit OTP";return}v.value=!0,w.value="";try{const P=await I(`${x.public.apiBase}/auth/verify-otp`,{method:"POST",body:{type:"email",value:a.value.trim(),otp:p}});n.value=((r=P.data)==null?void 0:r.valid)===!0,n.value||(w.value="Invalid OTP, please try again"),n.value&&(c.value=!1)}catch(P){w.value=(($=P==null?void 0:P.data)==null?void 0:$.message)||"OTP verification failed"}finally{v.value=!1}}async function G(){var p;if(n.value){l.value=!0;try{await I(`${x.public.apiBase}/account/contact`,{method:"PUT",body:{email:a.value.trim(),type:"email",otp:s.value.join("")}}),g.success({title:"Success!",message:"Email updated successfully."}),n.value=!1,c.value=!1,s.value=["","","","","",""],S=a.value.trim(),E.value=!1,_()}catch(r){g.error({title:"Error!",message:((p=r==null?void 0:r.data)==null?void 0:p.message)||"Failed to update email"})}finally{l.value=!1}}}return(p,r)=>(u(),f("form",{onSubmit:q(G,["prevent"]),class:"bg-white dark:bg-gray-800 shadow rounded-xl max-w-full mx-auto w-full my-4"},[e("div",we,[r[4]||(r[4]=e("div",{class:"p-6"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Change Email"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Update your email address and verify it with OTP. ")],-1)),e("div",xe,[e("div",null,[r[1]||(r[1]=e("label",{for:"email",class:"form-label"},"New Email Address",-1)),T(e("input",{"onUpdate:modelValue":r[0]||(r[0]=$=>a.value=$),id:"email",type:"email",placeholder:"you@example.com",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 rounded-md mt-1",onBlur:O},null,544),[[C,a.value]]),m.value?(u(),f("span",_e,k(m.value),1)):B("",!0)]),E.value&&!n.value?(u(),f("div",he,[e("button",{type:"button",onClick:W,disabled:b.value,class:"btn-green text-sm px-4 py-2"},k(c.value?`Resend OTP (${i.value}s)`:"Send OTP"),9,ke)])):B("",!0),c.value&&!n.value?(u(),f("div",Ee,[r[2]||(r[2]=e("label",{class:"form-label mt-4 text-center"},"Enter OTP",-1)),e("div",$e,[(u(!0),f(Z,null,J(s.value,($,P)=>T((u(),f("input",{key:P,maxlength:"1",type:"text",inputmode:"numeric",class:"otp-input","onUpdate:modelValue":M=>s.value[P]=M,onInput:M=>Y(P,M)},null,40,Se)),[[C,s.value[P]]])),128))]),w.value?(u(),f("span",Pe,k(w.value),1)):B("",!0),e("button",{type:"button",onClick:z,class:"btn-blue mt-4 w-full sm:w-1/2 md:w-1/3",disabled:v.value||s.value.join("").length<6},k(v.value?"Verifying...":"Verify OTP"),9,Be)])):B("",!0),n.value?(u(),f("div",Ve,[r[3]||(r[3]=e("p",{class:"text-green-600 font-semibold text-sm"},"âœ… OTP Verified Successfully",-1)),e("button",{type:"submit",class:"btn-blue mt-2 w-full sm:w-1/2 md:w-1/3",disabled:l.value},k(l.value?"Saving...":"Save Email"),9,Te)])):B("",!0)])])],32))}}),Ce=F(Ie,[["__scopeId","data-v-809d6510"]]),Oe={class:"max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8 space-y-8"},Ue={key:1},Fe={class:"grid grid-cols-1 md:grid-cols-[250px_1fr] divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700"},Me={class:"p-6 space-y-6 flex flex-col"},Ne={class:"flex flex-col gap-4"},qe={class:"gap-2"},Ae={key:0,class:"form-error"},Re={class:"gap-2"},je={key:0,class:"form-error"},De={class:"gap-2"},Le={key:0,class:"form-error"},Ye={class:"flex flex-row"},We=["disabled"],ze={class:"grid grid-cols-1 md:grid-cols-[250px_1fr] divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700"},Ge={class:"p-4 space-y-6"},He={class:"flex flex-col gap-4"},Xe={class:"gap-2"},Ze={key:0,class:"form-error"},Je={class:"flex flex-row"},Ke=["disabled"],Qe=U({__name:"edit",setup(d){const g=j(),{refreshUser:x}=R(),y=A(),_=K("pageLoading",()=>!1),a=L("PUT",`${g.public.apiBase}/account/profile`,{name:"",bio:"",gender:"",dob:""}),s=h(null);function c(){s.value&&(s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px")}async function n(){try{const t=(await I(`${g.public.apiBase}/account/profile`)).data;a.name=t.name??"",a.gender=t.gender??"",a.dob=t.dob??"",a.bio=t.bio??""}catch{y.error({title:"Error",message:"Failed to load profile"})}}D(()=>{n(),c(),_.value=!1}),Q(()=>a.bio,c);async function b(){var i;l();try{await a.submit({only:["name","gender","dob"]}),y.success({title:"Success",message:"Profile info updated successfully"}),x()}catch(t){y.error({title:"Error",message:((i=t==null?void 0:t.data)==null?void 0:i.message)||"Failed to update profile"})}}async function v(){var i;l();try{await a.submit({only:["bio"]}),y.success({title:"Success",message:"Bio updated successfully"}),x()}catch(t){y.error({title:"Error",message:((i=t==null?void 0:t.data)==null?void 0:i.message)||"Failed to update bio"})}}function l(){a.errors={}}return(i,t)=>(u(),f("div",Oe,[t[13]||(t[13]=e("div",{class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6"},[e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"My Account"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Manage your personal profile and secure your account. ")])],-1)),o(_)?(u(),ee(se,{key:0})):(u(),f("div",Ue,[V(ae),e("form",{onSubmit:q(b,["prevent"]),class:"bg-white dark:bg-gray-800 shadow rounded-xl"},[e("div",Fe,[t[9]||(t[9]=e("div",{class:"p-6"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Basic Information"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Update your name, gender, and date of birth. ")],-1)),e("div",Me,[e("div",Ne,[e("div",qe,[t[4]||(t[4]=e("label",null,"Name",-1)),T(e("input",{"onUpdate:modelValue":t[0]||(t[0]=m=>o(a).name=m),type:"text",class:"form-input",required:"",minlength:"3",placeholder:"Your full name"},null,512),[[C,o(a).name]]),o(a).errors.name?(u(),f("span",Ae,k(o(a).errors.name),1)):B("",!0)]),e("div",Re,[t[6]||(t[6]=e("label",null,"Gender",-1)),T(e("select",{"onUpdate:modelValue":t[1]||(t[1]=m=>o(a).gender=m),class:"form-input",required:""},t[5]||(t[5]=[e("option",{value:""},"Select gender",-1),e("option",{value:"male"},"Male",-1),e("option",{value:"female"},"Female",-1),e("option",{value:"other"},"Other",-1)]),512),[[te,o(a).gender]]),o(a).errors.gender?(u(),f("span",je,k(o(a).errors.gender),1)):B("",!0)]),e("div",De,[t[7]||(t[7]=e("label",null,"Date of Birth",-1)),T(e("input",{"onUpdate:modelValue":t[2]||(t[2]=m=>o(a).dob=m),type:"date",class:"form-input",required:""},null,512),[[C,o(a).dob]]),o(a).errors.dob?(u(),f("span",Le,k(o(a).errors.dob),1)):B("",!0)])]),e("div",Ye,[t[8]||(t[8]=e("div",{class:"grow hidden md:block"},null,-1)),e("button",{type:"submit",class:"btn-primary",disabled:o(a).processing},"Update Info",8,We)])])])],32),e("form",{onSubmit:q(v,["prevent"]),class:"bg-white dark:bg-gray-800 shadow rounded-xl"},[e("div",ze,[t[12]||(t[12]=e("div",{class:"p-6"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Bio"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Write something about yourself for your profile. ")],-1)),e("div",Ge,[e("div",He,[e("div",Xe,[t[10]||(t[10]=e("label",null,"Bio",-1)),T(e("textarea",{ref_key:"bioRef",ref:s,"onUpdate:modelValue":t[3]||(t[3]=m=>o(a).bio=m),class:"form-input overflow-hidden",rows:"2",maxlength:"500",placeholder:"Write something about yourself",onInput:c},null,544),[[C,o(a).bio]]),o(a).errors.bio?(u(),f("span",Ze,k(o(a).errors.bio),1)):B("",!0)])]),e("div",Je,[t[11]||(t[11]=e("div",{class:"grow hidden md:block"},null,-1)),e("button",{type:"submit",class:"btn-primary",disabled:o(a).processing},"Save Bio",8,Ke)])])])],32),V(oe),V(Ce),V(be)]))]))}}),it=F(Qe,[["__scopeId","data-v-754c0416"]]);export{it as default};
