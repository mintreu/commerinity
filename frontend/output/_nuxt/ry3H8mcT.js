import{b4 as $,bi as j,br as F,bd as i,ba as R,aY as c,a_ as v,bk as Y,b5 as t,bg as y,bl as M,bm as I,b8 as g,be as A,bf as L,bo as k,aW as W,aX as X}from"./B132AJ_X.js";import{s as q}from"./BjZ6Woku.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};u.SENTRY_RELEASE={id:"3703708ef9ac1b45e23fc2a6a145a79341d4c60a"}}catch{}})();try{(function(){var u=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new u.Error().stack;r&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[r]="6af65aa7-46f6-4a73-960f-3161fa717f2d",u._sentryDebugIdIdentifier="sentry-dbid-6af65aa7-46f6-4a73-960f-3161fa717f2d")})()}catch{}const z={class:"grid grid-cols-1 md:grid-cols-[250px_1fr] divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700"},G={class:"p-4 space-y-6"},H={class:"flex items-center mt-1"},J={key:0,class:"form-error"},K={key:0,class:"flex justify-end"},Q=["disabled"],Z={key:1,class:"flex flex-col items-center w-full"},ee={class:"flex justify-center gap-1 mt-2 flex-wrap"},ae=["onUpdate:modelValue","onInput"],te={key:0,class:"form-error mt-2"},le=["disabled"],se={key:2,class:"text-center mt-4"},oe=["disabled"],ie=$({__name:"ChangeMobile",setup(u){const r=j(),x=W(),{user:O,refreshUser:B}=F(),d=i(""),b=i(["","","","","",""]),m=i(!1),l=i(!1),h=i(!1),w=i(!1),_=i(!1),T=i(60);let E=null;const p=i(""),s=i(""),f=i(!1);let S="";R(()=>{var a;(a=O.value)!=null&&a.mobile&&(d.value=O.value.mobile,S=O.value.mobile)});async function C(){const a=d.value.trim();if(a===S){m.value=!1,l.value=!1,s.value="",f.value=!1;return}if(!/^[6-9]\d{9}$/.test(a)){p.value="Enter a valid 10-digit Indian mobile number",f.value=!1;return}p.value="",m.value=!1,l.value=!1,s.value="";try{const o=await k(`${x.public.apiBase}/auth/has_contact`,{method:"POST",body:{type:"mobile",value:a}});f.value=!o.data.exists,o.data.exists&&(p.value="Mobile number already in use")}catch{p.value="Failed to check mobile",f.value=!1}}function V(a,e){if(e.inputType!=="deleteContentBackward"){const o=e.target.nextElementSibling;o&&o.focus()}}async function D(){var a;s.value="",l.value=!1,h.value=!0;try{await k(`${x.public.apiBase}/auth/send-otp`,{method:"POST",body:{type:"mobile",value:d.value.trim()}}),m.value=!0,f.value=!1,T.value=60,E=q(()=>{T.value--,T.value<=0&&(clearInterval(E),f.value=!0,h.value=!1)},1e3),r.info({title:"OTP Sent",message:"A 6-digit OTP has been sent to your mobile."})}catch(e){s.value=((a=e==null?void 0:e.data)==null?void 0:a.message)||"Failed to send OTP",h.value=!1,r.error({title:"Error",message:s.value})}}async function N(){var e,o;const a=b.value.join("");if(a.length!==6){s.value="Enter 6-digit OTP";return}w.value=!0,s.value="";try{const n=await k(`${x.public.apiBase}/auth/verify-otp`,{method:"POST",body:{type:"mobile",value:d.value.trim(),otp:a}});l.value=((e=n.data)==null?void 0:e.valid)===!0,l.value||(s.value="Invalid OTP, please try again"),l.value&&(m.value=!1)}catch(n){s.value=((o=n==null?void 0:n.data)==null?void 0:o.message)||"OTP verification failed"}finally{w.value=!1}}async function U(){var a;if(l.value){_.value=!0;try{await k(`${x.public.apiBase}/account/contact`,{method:"PUT",body:{mobile:d.value.trim(),type:"mobile",otp:b.value.join("")}}),r.success({title:"Success!",message:"Mobile number updated successfully."}),l.value=!1,b.value=["","","","","",""],S=d.value.trim(),f.value=!1,B()}catch(e){r.error({title:"Error!",message:((a=e==null?void 0:e.data)==null?void 0:a.message)||"Failed to update mobile"})}finally{_.value=!1}}}return(a,e)=>(v(),c("form",{onSubmit:Y(U,["prevent"]),class:"bg-white dark:bg-gray-800 shadow rounded-xl max-w-full mx-auto w-full my-4"},[t("div",z,[e[5]||(e[5]=t("div",{class:"p-6"},[t("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Manage Your Mobile"),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Update your mobile number and verify it with OTP. ")],-1)),t("div",G,[t("div",null,[e[2]||(e[2]=t("label",{for:"mobile",class:"form-label"},"Your Mobile Number",-1)),t("div",H,[e[1]||(e[1]=t("span",{class:"px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-r-0 rounded-l-md text-gray-700 dark:text-gray-300"},"+91",-1)),M(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),id:"mobile",type:"tel",placeholder:"9876543210",class:"w-full flex-1 px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 rounded-r-md",onBlur:C},null,544),[[I,d.value]])]),p.value?(v(),c("span",J,g(p.value),1)):y("",!0)]),f.value&&!l.value?(v(),c("div",K,[t("button",{type:"button",onClick:D,disabled:h.value,class:"btn-green text-sm px-4 py-2"},g(m.value?`Resend OTP (${T.value}s)`:"Send OTP"),9,Q)])):y("",!0),m.value&&!l.value?(v(),c("div",Z,[e[3]||(e[3]=t("label",{class:"form-label mt-4 text-center"},"Enter OTP",-1)),t("div",ee,[(v(!0),c(A,null,L(b.value,(o,n)=>M((v(),c("input",{key:n,maxlength:"1",type:"text",inputmode:"numeric",class:"otp-input","onUpdate:modelValue":P=>b.value[n]=P,onInput:P=>V(n,P)},null,40,ae)),[[I,b.value[n]]])),128))]),s.value?(v(),c("span",te,g(s.value),1)):y("",!0),t("button",{type:"button",onClick:N,class:"btn-blue mt-4 w-full sm:w-1/2 md:w-1/3",disabled:w.value||b.value.join("").length<6},g(w.value?"Verifying...":"Verify OTP"),9,le)])):y("",!0),l.value?(v(),c("div",se,[e[4]||(e[4]=t("p",{class:"text-green-600 font-semibold text-sm"},"âœ… OTP Verified Successfully",-1)),t("button",{type:"submit",class:"btn-blue mt-2 w-full sm:w-1/2 md:w-1/3",disabled:_.value},g(_.value?"Saving...":"Save Mobile Number"),9,oe)])):y("",!0)])])],32))}}),re=X(ie,[["__scopeId","data-v-c7141f24"]]);export{re as C};
