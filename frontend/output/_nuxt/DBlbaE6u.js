import{b4 as K,bi as Z,bd as z,bz as A,by as H,ba as J,aY as u,b5 as e,bk as X,bl as x,bg as _,bm as U,bh as k,b8 as w,bv as Q,be as $,bf as j,bo as D,aW as tt,a_ as p,bB as et,aX as at}from"./B132AJ_X.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};i.SENTRY_RELEASE={id:"3703708ef9ac1b45e23fc2a6a145a79341d4c60a"}}catch{}})();try{(function(){var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},d=new i.Error().stack;d&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[d]="a7060424-1d3b-409a-a489-89d626d64dbb",i._sentryDebugIdIdentifier="sentry-dbid-a7060424-1d3b-409a-a489-89d626d64dbb")})()}catch{}const o=[];for(let i=0;i<256;++i)o.push((i+256).toString(16).slice(1));function st(i,d=0){return(o[i[d+0]]+o[i[d+1]]+o[i[d+2]]+o[i[d+3]]+"-"+o[i[d+4]]+o[i[d+5]]+"-"+o[i[d+6]]+o[i[d+7]]+"-"+o[i[d+8]]+o[i[d+9]]+"-"+o[i[d+10]]+o[i[d+11]]+o[i[d+12]]+o[i[d+13]]+o[i[d+14]]+o[i[d+15]]).toLowerCase()}let I;const lt=new Uint8Array(16);function it(){if(!I){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");I=crypto.getRandomValues.bind(crypto)}return I(lt)}const nt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),P={randomUUID:nt};function R(i,d,C){var b;if(P.randomUUID&&!i)return P.randomUUID();i=i||{};const g=i.random??((b=i.rng)==null?void 0:b.call(i))??it();if(g.length<16)throw new Error("Random bytes length must be >= 16");return g[6]=g[6]&15|64,g[8]=g[8]&63|128,st(g)}const rt={class:"min-h-screen p-4 flex justify-center bg-gray-100 dark:bg-gray-900"},dt={class:"w-full max-w-3xl bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ot={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded space-y-3"},ut={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},pt={class:"md:col-span-2"},ct={key:0,class:"mt-1 text-xs text-red-600"},gt={class:"flex flex-col gap-2"},yt={class:"mt-2 flex items-center gap-3"},ft={class:"w-28 h-28 border rounded overflow-hidden bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},mt=["src"],bt={key:1,class:"text-xs text-gray-400"},xt={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded space-y-3"},ht={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},vt={class:"md:col-span-2"},_t={key:0,class:"mt-1 text-xs text-red-600"},kt={class:"flex flex-col gap-2"},wt={class:"mt-2 flex items-center gap-3"},Ut={class:"w-28 h-28 border rounded overflow-hidden bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},Ct=["src"],St={key:1,class:"text-xs text-gray-400"},Tt={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded space-y-3"},At={class:"flex items-center gap-4"},It={class:"inline-flex items-center cursor-pointer"},Et={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start"},Ft={class:"md:col-span-2"},$t={key:0,class:"mt-1 text-xs text-red-600"},jt={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded space-y-3"},Dt={class:"space-y-3"},Pt={class:"md:col-span-2"},Rt=["onUpdate:modelValue","onChange"],Vt=["value"],Bt={class:"md:col-span-3"},Gt=["onUpdate:modelValue"],Nt={class:"md:col-span-1 flex gap-2"},Lt=["onClick"],Ot=["disabled"],Wt={key:0,class:"text-xs text-gray-500 mt-2"},Yt={class:"text-center"},qt=["disabled"],Mt={key:0},Kt={key:1},Zt=K({__name:"kyc",setup(i){const d=Z(),C=tt(),g=z(!1),b=[{value:"electricity",label:"Electricity Bill"},{value:"gas",label:"Gas Bill"},{value:"telephone",label:"Telephone / Landline"},{value:"water",label:"Water Bill"},{value:"other",label:"Other"}],s=A({aadhaar:"",pan:"",aadhaarFile:null,panFile:null,aadhaarImageUrl:"",panImageUrl:"",hasTax:!1,gst:"",gstFile:null,utility_bills:[]}),f=A({aadhaar:"",pan:"",gst:""}),r=A({});function h(l){r[l]=""}function V(l){const t=s.utility_bills.map((a,n)=>n===l?null:a.type).filter(Boolean);return b.filter(a=>!t.includes(a.value))}const E=H(()=>{const l=b.length-s.utility_bills.length;return l<=0?"All utility types added.":`${l} types left to add.`});function B(){s.utility_bills.length>=b.length||s.utility_bills.push({id:R(),type:"",identifier:""})}function G(l){s.utility_bills.splice(l,1),delete r[`utility_${l}`]}function N(l){const t=new Set;for(let a=0;a<s.utility_bills.length;a++){const n=s.utility_bills[a].type;n&&(t.has(n)&&a!==l?(s.utility_bills[a].type="",s.utility_bills[a].identifier=""):t.add(n))}h(`utility_${l}`)}function S(l,t){var c;const n=((c=l.target.files)==null?void 0:c[0])??null;t==="aadhaar"?(s.aadhaarFile=n,f.aadhaar=n&&n.type.startsWith("image/")?URL.createObjectURL(n):""):t==="pan"?(s.panFile=n,f.pan=n&&n.type.startsWith("image/")?URL.createObjectURL(n):""):(s.gstFile=n,f.gst=n&&n.type.startsWith("image/")?URL.createObjectURL(n):""),h(t)}async function F(){try{const l=await D(`${C.public.apiBase}/account/kyc`),t=(l==null?void 0:l.data)??{};s.aadhaar=(t.aadhaar||"").replace(/\D/g,""),s.pan=(t.pan||"").toUpperCase(),t.aadhaarImage&&(f.aadhaar=t.aadhaarImage),t.panImage&&(f.pan=t.panImage),s.hasTax=!!t.has_tax,s.gst=(t.gst||"").toUpperCase(),Array.isArray(t.utility_bills)&&(s.utility_bills=t.utility_bills.map(a=>({id:R(),type:a.type||"",identifier:a.value||""})))}catch(l){console.error("loadExisting KYC error",l)}}J(F);function L(){const l=(s.aadhaar||"").trim();return l?/^\d{12}$/.test(l)?(r.aadhaar="",!0):(r.aadhaar="Aadhaar must be 12 digits.",!1):(r.aadhaar="Aadhaar is required.",!1)}function O(){const l=(s.pan||"").toUpperCase().trim();return l?/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(l)?(r.pan="",!0):(r.pan="PAN format invalid (e.g. ABCDE1234F).",!1):(r.pan="PAN is required.",!1)}function W(){if(!s.hasTax)return r.gst="",!0;const l=(s.gst||"").toUpperCase().trim();return l?/^[0-9A-Z]{15}$/.test(l)?(r.gst="",!0):(r.gst="GST must be 15 alphanumeric characters.",!1):(r.gst="GST number is required when you have GST.",!1)}function Y(){let l=!0;const t=new Set;return s.utility_bills.forEach((a,n)=>{if(!a.type&&!a.identifier){r[`utility_${n}`]="";return}if(!a.type){r[`utility_${n}`]="Select utility type or remove this row.",l=!1;return}if(!a.identifier||!a.identifier.trim()){r[`utility_${n}`]="Enter identifier / account number.",l=!1;return}if(t.has(a.type)){r[`utility_${n}`]="This type is already chosen.",l=!1;return}t.add(a.type),r[`utility_${n}`]=""}),l}function q(){const l=L(),t=O(),a=W(),n=Y();return l&&t&&a&&n}function v(l=""){return`w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 ${l?"border-red-600 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`}async function M(){var l,t;if(!q()){d.error({title:"Validation",message:"Please fix highlighted errors."});return}g.value=!0;try{const a=new FormData;a.append("aadhaar",s.aadhaar),a.append("pan",s.pan),a.append("has_tax",s.hasTax?"1":"0"),s.hasTax&&a.append("gst",s.gst),s.aadhaarFile&&a.append("aadhaar_file",s.aadhaarFile),s.panFile&&a.append("pan_file",s.panFile),s.gstFile&&a.append("gst_file",s.gstFile);const n=s.utility_bills.filter(m=>m.type&&m.identifier&&m.identifier.trim()).map(m=>({type:m.type,value:m.identifier.trim()}));a.append("utility_bills",JSON.stringify(n));const c=`${C.public.apiBase}/user/kyc`,y=await D(c,{method:"POST",body:a});(l=y==null?void 0:y.data)!=null&&l.success||y!=null&&y.success?(d.success({title:"Submitted",message:"KYC submitted successfully."}),await F()):(t=y==null?void 0:y.data)!=null&&t.errors?(Object.entries(y.data.errors).forEach(([m,T])=>{r[m]=Array.isArray(T)?T.join(", "):T}),d.error({title:"Error",message:"Server validation failed. See highlighted fields."})):d.error({title:"Error",message:"Submission failed. Please try again."})}catch(a){console.error("submit error",a),d.error({title:"Error",message:(a==null?void 0:a.message)||"Submission error"})}finally{g.value=!1}}return(l,t)=>(p(),u("div",rt,[e("div",dt,[t[26]||(t[26]=e("h1",{class:"text-2xl font-semibold mb-4 text-gray-800 dark:text-white text-center"},"Complete KYC",-1)),e("form",{onSubmit:X(M,["prevent"]),class:"space-y-6"},[e("section",ot,[t[13]||(t[13]=e("div",{class:"flex items-center justify-between"},[e("h2",{class:"text-lg font-medium text-gray-700 dark:text-gray-200"},"Aadhaar"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"12 digits")],-1)),e("div",ut,[e("div",pt,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Aadhaar number",-1)),x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.aadhaar=a),onInput:t[1]||(t[1]=a=>h("aadhaar")),maxlength:"12",inputmode:"numeric",placeholder:"123412341234",class:k([v(r.aadhaar),"w-full"])},null,34),[[U,s.aadhaar]]),r.aadhaar?(p(),u("p",ct,w(r.aadhaar),1)):_("",!0)]),e("div",gt,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Upload Aadhaar (jpg/png/pdf)",-1)),e("input",{type:"file",accept:"image/*,application/pdf",onChange:t[2]||(t[2]=a=>S(a,"aadhaar")),class:"block w-full text-sm text-gray-600 dark:text-gray-400"},null,32)])]),e("div",yt,[e("div",ft,[f.aadhaar?(p(),u("img",{key:0,src:f.aadhaar,class:"max-h-full max-w-full object-contain"},null,8,mt)):(p(),u("span",bt,"No preview"))]),t[12]||(t[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-300"},"We accept JPG/PNG/PDF. PDFs will be stored as-is.",-1))])]),e("section",xt,[t[17]||(t[17]=e("div",{class:"flex items-center justify-between"},[e("h2",{class:"text-lg font-medium text-gray-700 dark:text-gray-200"},"PAN"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"10 chars, e.g. ABCDE1234F")],-1)),e("div",ht,[e("div",vt,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"PAN number",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>s.pan=a),onInput:t[4]||(t[4]=a=>{s.pan=s.pan.toUpperCase(),h("pan")}),maxlength:"10",placeholder:"ABCDE1234F",class:k([v(r.pan),"w-full"])},null,34),[[U,s.pan]]),r.pan?(p(),u("p",_t,w(r.pan),1)):_("",!0)]),e("div",kt,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Upload PAN (jpg/png/pdf)",-1)),e("input",{type:"file",accept:"image/*,application/pdf",onChange:t[5]||(t[5]=a=>S(a,"pan")),class:"block w-full text-sm text-gray-600 dark:text-gray-400"},null,32)])]),e("div",wt,[e("div",Ut,[f.pan?(p(),u("img",{key:0,src:f.pan,class:"max-h-full max-w-full object-contain"},null,8,Ct)):(p(),u("span",St,"No preview"))]),t[16]||(t[16]=e("p",{class:"text-sm text-gray-600 dark:text-gray-300"},"Clear, legible images help fast verification.",-1))])]),e("section",Tt,[t[21]||(t[21]=e("div",{class:"flex items-center justify-between"},[e("h2",{class:"text-lg font-medium text-gray-700 dark:text-gray-200"},"GST (optional)"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Only required if you have GST")],-1)),e("div",At,[e("label",It,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=a=>s.hasTax=a),class:"mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded"},null,512),[[Q,s.hasTax]]),t[18]||(t[18]=e("span",{class:"text-gray-700 dark:text-gray-200"},"I have GST",-1))])]),s.hasTax?(p(),u("div",Et,[e("div",Ft,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"GST number",-1)),x(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>s.gst=a),onInput:t[8]||(t[8]=a=>{s.gst=s.gst.toUpperCase(),h("gst")}),maxlength:"15",placeholder:"15-character GSTIN",class:k([v(r.gst),"w-full"])},null,34),[[U,s.gst]]),r.gst?(p(),u("p",$t,w(r.gst),1)):_("",!0)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Upload GST (jpg/png/pdf)",-1)),e("input",{type:"file",accept:"image/*,application/pdf",onChange:t[9]||(t[9]=a=>S(a,"gst")),class:"block w-full text-sm text-gray-600 dark:text-gray-400"},null,32)])])):_("",!0)]),e("section",jt,[t[25]||(t[25]=e("div",{class:"flex items-center justify-between"},[e("h2",{class:"text-lg font-medium text-gray-700 dark:text-gray-200"},"Utility Bills (optional)"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Provide one or more â€” no files required")],-1)),e("div",Dt,[(p(!0),u($,null,j(s.utility_bills,(a,n)=>(p(),u("div",{key:a.id,class:"grid grid-cols-1 md:grid-cols-6 gap-2 items-center"},[e("div",Pt,[t[23]||(t[23]=e("label",{class:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1"},"Type",-1)),x(e("select",{"onUpdate:modelValue":c=>a.type=c,onChange:c=>N(n),class:k([v(r[`utility_${n}`]),"w-full"])},[t[22]||(t[22]=e("option",{value:""},"Select type",-1)),(p(!0),u($,null,j(V(n),c=>(p(),u("option",{key:c.value,value:c.value},w(c.label),9,Vt))),128))],42,Rt),[[et,a.type]])]),e("div",Bt,[t[24]||(t[24]=e("label",{class:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1"},"Identifier / account no.",-1)),x(e("input",{"onUpdate:modelValue":c=>a.identifier=c,type:"text",placeholder:"Enter bill / account number",class:k(v(r[`utility_${n}`]))},null,10,Gt),[[U,a.identifier]])]),e("div",Nt,[e("button",{type:"button",onClick:c=>G(n),class:"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700"},"Remove",8,Lt)])]))),128)),e("div",null,[e("button",{type:"button",onClick:B,disabled:s.utility_bills.length>=b.length,class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"}," Add Utility ",8,Ot),E.value?(p(),u("p",Wt,w(E.value),1)):_("",!0)])])]),e("div",Yt,[e("button",{type:"submit",disabled:g.value,class:"px-6 py-2 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50"},[g.value?(p(),u("span",Mt,"Submitting...")):(p(),u("span",Kt,"Submit KYC"))],8,qt)])],32)])]))}}),Ht=at(Zt,[["__scopeId","data-v-dabd6f8f"]]);export{Ht as default};
