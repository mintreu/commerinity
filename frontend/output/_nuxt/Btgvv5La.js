import{b4 as de,bq as ce,bi as ue,bd as g,by as ge,ba as me,aY as o,b5 as e,bg as v,aZ as f,b8 as n,bG as ye,be as h,bf as A,bk as xe,bl as pe,bm as he,b7 as ve,bj as be,bh as L,bt as fe,bo as J,aW as ke,bw as D,bc as _e,a_ as r}from"./B132AJ_X.js";import{_ as we}from"./CzGapVpC.js";(function(){try{var b=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};b.SENTRY_RELEASE={id:"3703708ef9ac1b45e23fc2a6a145a79341d4c60a"}}catch{}})();try{(function(){var b=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},S=new b.Error().stack;S&&(b._sentryDebugIds=b._sentryDebugIds||{},b._sentryDebugIds[S]="d4e7d1bf-2d44-4017-8d4f-055d3e6dd547",b._sentryDebugIdIdentifier="sentry-dbid-d4e7d1bf-2d44-4017-8d4f-055d3e6dd547")})()}catch{}const Te={class:"p-4 sm:p-6 max-w-screen-xl mx-auto space-y-6 sm:space-y-8"},Se={class:"flex items-center gap-3"},Ee={key:0,class:"w-full flex items-center justify-center py-16"},ze={class:"flex items-center gap-3 text-gray-700 dark:text-gray-300"},Re={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Fe={class:"px-4 sm:px-6 py-3 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 rounded-t-lg"},Ae={class:"flex items-center justify-between"},Ie=["aria-pressed"],$e={ref:"topSentinel"},Ce=["src","alt"],je={class:"max-w-[82%] sm:max-w-[75%]"},Be={class:"text-xs text-gray-700 dark:text-gray-300 mb-1"},Le={class:"p-3 rounded-2xl text-sm shadow-sm break-words ring-1 bg-gray-50 text-gray-900 ring-gray-200 dark:bg-gray-800 dark:text-gray-100 dark:ring-gray-700"},Me={class:"leading-relaxed"},Ne={key:0,class:"mt-2 grid grid-cols-2 gap-2"},De=["src","alt"],Ge={class:"mt-1 text-[11px] flex items-center justify-between"},Pe={class:"truncate"},He={class:"text-gray-700 dark:text-gray-300"},Oe=["href"],Ue={class:"ml-1 text-gray-700 dark:text-gray-300"},Ve={class:"mt-1 text-[10px] text-gray-700 dark:text-gray-300"},We={class:"max-w-[82%] sm:max-w-[75%]"},Xe={class:"text-right text-xs text-gray-700 dark:text-gray-300 mb-1"},Ye={class:"p-3 rounded-2xl text-sm shadow-sm break-words ring-1 bg-blue-500 text-white ring-blue-600 dark:bg-blue-600 dark:ring-blue-700"},Ze={class:"leading-relaxed"},qe={key:0,class:"mt-2 grid grid-cols-2 gap-2"},Je=["src","alt"],Ke={class:"mt-1 text-[11px] flex items-center justify-between"},Qe={class:"truncate"},et={class:"text-white dark:text-gray-100"},tt=["href"],at={class:"ml-1 text-white dark:text-gray-100"},st={class:"mt-1 text-[10px] text-white dark:text-gray-100 text-right"},rt=["src","alt"],ot={key:0,class:"flex items-center justify-center py-2"},nt={class:"mb-2 text-xs text-gray-700 dark:text-gray-400"},lt={class:"flex items-end gap-2"},it={class:"flex-1"},dt=["aria-invalid"],ct={key:0,class:"mt-1 text-xs text-red-600"},ut={class:"flex items-center gap-2"},gt={class:"cursor-pointer p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 shrink-0",title:"Attach images"},mt=["disabled"],yt={key:0,class:"mt-2 text-xs text-red-600"},xt={key:1,class:"mt-3 grid grid-cols-3 sm:grid-cols-5 gap-3 text-xs text-gray-800 dark:text-gray-200"},pt=["src","alt"],ht={class:"mt-1 w-20 truncate"},vt={class:"text-[11px] text-gray-700 dark:text-gray-300"},bt=["onClick"],ft={key:0,class:"bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 shadow-sm"},kt={class:"px-4 sm:px-6 py-4 sm:py-6 space-y-4"},_t={class:"flex items-start gap-3"},wt={class:"min-w-0"},Tt={class:"text-base font-medium text-gray-900 dark:text-gray-100 truncate"},St={class:"flex items-start gap-3"},Et={class:"flex items-start gap-3"},zt={class:"flex items-start gap-3"},Rt={class:"text-base text-gray-900 dark:text-gray-100"},Ft={class:"flex items-start gap-3"},At={class:"min-w-0"},It={class:"text-base text-gray-800 dark:text-gray-300 whitespace-pre-line break-words"},$t={key:0,class:"space-y-2"},Ct={class:"grid grid-cols-2 sm:grid-cols-3 gap-3"},jt=["href"],Bt=["src"],Lt={key:2},Mt="480px",Nt="68vh",I=1.5*1024*1024,$=10,Dt=120,Ht=de({__name:"[url]",setup(b){const S=ce(),E=ue(),G=ke(),x=g({uuid:"",title:"",status:"",priority:"",createdAt:"",description:""}),M=g([]),w=g([]),z=g(""),p=g([]),C=g(null),T=g(null),j=g(!0),R=g(!1),k=g(!1),N=g(!1),B=g(!1),P=g(!1),m=g({}),K=s=>URL.createObjectURL(s),_=s=>{const t=["B","KB","MB","GB"];let l=0,u=s;for(;u>=1024&&l<t.length-1;)u/=1024,l++;return`${u.toFixed(1)} ${t[l]}`},Q=/\.(jpe?g|png|gif|webp|avif)(?:\?.*)?$/i,H=s=>{try{return!!s&&Q.test(s)}catch{return!1}},ee=(s,t="image")=>{try{return new URL(s).pathname.split("/").pop()||t}catch{return s.split("/").pop()||t}},te=()=>{const s=C.value;s&&(s.style.height="auto",s.style.height=`${s.scrollHeight}px`)},ae=()=>{m.value={},!z.value.trim()&&p.value.length===0&&(m.value.message="Please type a message or attach at least one image."),p.value.length>$&&(m.value.attachments=`You can attach up to ${$} images.`);for(const s of p.value){if(!s.type.startsWith("image/")){m.value.attachments="Only image files are allowed.";break}if(s.size>I){m.value.attachments=`Each image must be ‚â§ ${_(I)}.`;break}}return Object.keys(m.value).length===0},se=s=>{const t=s.target;if(!t.files)return;const l=Array.from(t.files),u=[...p.value,...l],a=[];for(const d of u){if(!d.type.startsWith("image/")){E.error({title:"Invalid File",message:`‚ùå ${d.name} is not an image`,timeout:2500});continue}if(d.size>I){E.error({title:"Too Large",message:`‚ùå ${d.name} exceeds ${_(I)}`,timeout:2500});continue}a.push(d)}a.length>$&&E.error({title:"Too Many Files",message:`‚ùå Max ${$} images allowed`,timeout:2500}),p.value=a.slice(0,$),t.value=""},re=s=>p.value.splice(s,1);async function O(s=!1){var t,l;try{w.value.length||(j.value=!0);const u=S.params.url,a=await J(`${G.public.apiBase}/helpdesk/tickets/${u}`,{method:"GET",credentials:"include"}),d=((t=a.data)==null?void 0:t.value)??(a==null?void 0:a.value)??a;if(!(d!=null&&d.ticket))throw new Error("No ticket data returned");const c=d.ticket;x.value={uuid:c.uuid,title:c.title,status:c.status,priority:c.priority,createdAt:new Date(c.created_at).toLocaleString(),description:c.description??"",author:c.author?{email:c.author.email,name:c.author.name,fingerprint:c.author.fingerprint,avatar:c.author.avatar}:void 0},M.value=Array.isArray(c.attachment)?c.attachment:[];const F=((l=x.value.author)==null?void 0:l.fingerprint)||null,i=w.value.length;w.value=(d.conversations??[]).map(y=>{var W,X,Y,Z;const U={email:((W=y.author)==null?void 0:W.email)||"",name:((X=y.author)==null?void 0:X.name)||"Unknown",fingerprint:((Y=y.author)==null?void 0:Y.fingerprint)||"",avatar:((Z=y.author)==null?void 0:Z.avatar)||""},V=F?U.fingerprint!==F:!0;return{isSupport:V,from:V?"support":"user",text:y.message,timestamp:new Date(y.created_at).toLocaleString(),author:U,attachments:(Array.isArray(y.attachment)?y.attachment:[]).map(q=>({url:q,name:ee(q)}))}}),await D(),T.value&&(T.value.scrollTop=0),s&&i===w.value.length&&(N.value=!0,setTimeout(()=>N.value=!1,1500))}catch(u){console.error("Failed to load ticket",u),E.error({title:"Error",message:"‚ùå Failed to load ticket",timeout:3e3})}finally{j.value=!1}}const oe=async()=>{const s=T.value;!s||B.value||P.value||s.scrollTop<=Dt&&await ne()};async function ne(){const s=T.value;if(!s)return;B.value=!0;const t=s.scrollHeight,l=[];if(!l.length){P.value=!0,B.value=!1;return}w.value=[...l,...w.value],await D();const u=s.scrollHeight;s.scrollTop+=u-t,B.value=!1}const le=ge(()=>!!z.value.trim()||p.value.length>0);async function ie(){var s;if(!ae()){const t=m.value.message||m.value.attachments;t&&E.error({title:"Validation error",message:t,timeout:2500});return}try{R.value=!0;const t=S.params.url,l=new FormData;if(l.append("message",z.value),p.value.forEach(a=>l.append("attachments[]",a)),(s=(await J(`${G.public.apiBase}/helpdesk/tickets/${t}/reply`,{method:"POST",body:l,credentials:"include"})).error)!=null&&s.value)throw new Error("Reply failed");z.value="",p.value=[],await O(!0),await D(),C.value&&(C.value.style.height="auto"),T.value&&(T.value.scrollTop=0)}catch(t){console.error("Reply failed",t),E.error({title:"Error",message:"‚ùå Failed to send reply",timeout:3e3})}finally{R.value=!1}}return me(()=>O()),(s,t)=>{const l=_e,u=we;return r(),o("div",Te,[e("div",Se,[f(l,{name:"mdi-ticket",class:"text-blue-600 dark:text-blue-400 text-2xl"}),t[2]||(t[2]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Ticket Details",-1))]),j.value?(r(),o("div",Ee,[e("div",ze,[f(l,{name:"mdi-loading",class:"animate-spin"}),t[3]||(t[3]=e("span",null,"Loading ticket and conversation‚Ä¶",-1))])])):(r(),o("div",Re,[e("section",{class:L(["order-1 lg:order-none bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 shadow-sm flex flex-col",k.value?"lg:col-span-2":""])},[e("header",Fe,[e("div",Ae,[t[4]||(t[4]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"Conversation",-1)),e("button",{type:"button",onClick:t[0]||(t[0]=a=>k.value=!k.value),class:"inline-flex items-center gap-2 px-3 py-1.5 rounded border border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800","aria-pressed":k.value},[f(l,{name:k.value?"mdi-arrow-collapse":"mdi-arrow-expand"},null,8,["name"]),e("span",null,n(k.value?"Minimize":"Maximize"),1)],8,Ie)])]),e("div",{ref_key:"messagesContainer",ref:T,class:"px-4 sm:px-6 py-4 space-y-4 flex flex-col-reverse overflow-y-auto",style:ye({height:k.value?Nt:Mt}),onScrollPassive:oe},[e("div",$e,null,512),(r(!0),o(h,null,A(w.value,(a,d)=>{var c,F;return r(),o("div",{key:d,class:L(["flex items-start gap-3",a.isSupport?"justify-start":"justify-end"])},[a.isSupport?(r(),o(h,{key:0},[e("img",{src:a.author.avatar,alt:a.author.name,class:"w-8 h-8 rounded-full border border-gray-200 dark:border-gray-700 shrink-0"},null,8,Ce),e("div",je,[e("div",Be,n(a.author.name)+" ‚Ä¢ "+n(a.author.email),1),e("div",Le,[e("p",Me,n(a.text),1),(c=a.attachments)!=null&&c.length?(r(),o("div",Ne,[(r(!0),o(h,null,A(a.attachments,(i,y)=>(r(),o("div",{key:y,class:"text-xs"},[H(i.url)?(r(),o(h,{key:0},[e("img",{src:i.url,alt:i.name||"image",class:"max-h-40 w-auto rounded-md border border-gray-200 dark:border-gray-700"},null,8,De),e("div",Ge,[e("span",Pe,n(i.name||"image"),1),e("span",He,n(i.size?_(i.size):""),1)])],64)):(r(),o(h,{key:1},[e("a",{href:i.url,target:"_blank",class:"inline-flex items-center gap-1 underline underline-offset-2 text-blue-800 dark:text-blue-300"}," üìé "+n(i.name||"file"),9,Oe),e("span",Ue,n(i.size?_(i.size):""),1)],64))]))),128))])):v("",!0),e("div",Ve,n(a.timestamp),1)])])],64)):(r(),o(h,{key:1},[e("div",We,[e("div",Xe,n(a.author.name)+" ‚Ä¢ "+n(a.author.email),1),e("div",Ye,[e("p",Ze,n(a.text),1),(F=a.attachments)!=null&&F.length?(r(),o("div",qe,[(r(!0),o(h,null,A(a.attachments,(i,y)=>(r(),o("div",{key:y,class:"text-xs"},[H(i.url)?(r(),o(h,{key:0},[e("img",{src:i.url,alt:i.name||"image",class:"max-h-40 w-auto rounded-md border border-gray-200 dark:border-gray-700"},null,8,Je),e("div",Ke,[e("span",Qe,n(i.name||"image"),1),e("span",et,n(i.size?_(i.size):""),1)])],64)):(r(),o(h,{key:1},[e("a",{href:i.url,target:"_blank",class:"inline-flex items-center gap-1 underline underline-offset-2 text-white dark:text-gray-100"}," üìé "+n(i.name||"file"),9,tt),e("span",at,n(i.size?_(i.size):""),1)],64))]))),128))])):v("",!0),e("div",st,n(a.timestamp),1)])]),e("img",{src:a.author.avatar,alt:a.author.name,class:"w-8 h-8 rounded-full border border-gray-200 dark:border-gray-700 shrink-0"},null,8,rt)],64))],2)}),128)),N.value?(r(),o("div",ot,t[5]||(t[5]=[e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"No new messages",-1)]))):v("",!0)],36),e("form",{novalidate:"",onSubmit:xe(ie,["prevent"]),class:"px-4 sm:px-6 py-3 border-t border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 rounded-b-lg"},[e("div",nt," Send a message and optionally attach up to 10 images (JPG, PNG, GIF, WEBP, AVIF). Max size per image: "+n(_(I))+". ",1),e("div",lt,[e("div",it,[pe(e("textarea",{ref_key:"textareaRef",ref:C,"onUpdate:modelValue":t[1]||(t[1]=a=>z.value=a),onInput:te,rows:"1",placeholder:"Type a message to support‚Ä¶",class:"w-full resize-none overflow-hidden bg-white dark:bg-gray-800 text-sm text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 border border-gray-300 dark:border-gray-700 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-invalid":!!m.value.message},null,40,dt),[[he,z.value,void 0,{trim:!0}]]),m.value.message?(r(),o("p",ct,n(m.value.message),1)):v("",!0)]),e("div",ut,[e("label",gt,[t[6]||(t[6]=ve(" üìé ")),e("input",{type:"file",accept:"image/*",multiple:"",onChange:se,class:"hidden"},null,32)]),e("button",{type:"submit",disabled:R.value||!le.value,class:"shrink-0 inline-flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-blue-500"},[R.value?(r(),be(l,{key:0,name:"mdi-loading",class:"animate-spin mr-2"})):v("",!0),e("span",null,n(R.value?"Sending‚Ä¶":"Send"),1)],8,mt)])]),m.value.attachments?(r(),o("p",yt,n(m.value.attachments),1)):v("",!0),p.value.length?(r(),o("div",xt,[(r(!0),o(h,null,A(p.value,(a,d)=>(r(),o("div",{key:d,class:"relative group"},[e("img",{src:K(a),alt:a.name,class:"h-20 w-20 object-cover rounded-md border border-gray-200 dark:border-gray-700"},null,8,pt),e("div",ht,n(a.name),1),e("div",vt,n(_(a.size)),1),e("button",{type:"button",onClick:c=>re(d),class:"absolute -top-1.5 -right-1.5 bg-red-600 text-white text-[10px] rounded-full px-1.5 py-0.5 opacity-90 hover:opacity-100","aria-label":"Remove attachment",title:"Remove"}," ‚úï ",8,bt)]))),128))])):v("",!0)],32)],2),k.value?v("",!0):(r(),o("section",ft,[t[13]||(t[13]=e("header",{class:"px-4 sm:px-6 py-3 border-b border-gray-100 dark:border-gray-800"},[e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"Ticket Information")],-1)),e("div",kt,[e("div",_t,[f(l,{name:"mdi-format-title",class:"text-gray-600 dark:text-gray-400 mt-1"}),e("div",wt,[t[7]||(t[7]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Title",-1)),e("div",Tt,n(x.value.title),1)])]),e("div",St,[f(l,{name:"mdi-information",class:"text-gray-600 dark:text-gray-400 mt-1"}),e("div",null,[t[8]||(t[8]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Status",-1)),e("span",{class:L(["inline-block px-3 py-1 text-xs font-semibold rounded-full",x.value.status==="Open"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":x.value.status==="Resolved"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"])},n(x.value.status),3)])]),e("div",Et,[f(l,{name:"mdi-alert-circle",class:"text-gray-600 dark:text-gray-400 mt-1"}),e("div",null,[t[9]||(t[9]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Priority",-1)),e("span",{class:L(["inline-block px-3 py-1 text-xs font-semibold rounded-full",x.value.priority==="High"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200":x.value.priority==="Medium"?"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-200":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"])},n(x.value.priority),3)])]),e("div",zt,[f(l,{name:"mdi-calendar-clock",class:"text-gray-600 dark:text-gray-400 mt-1"}),e("div",null,[t[10]||(t[10]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Created At",-1)),e("div",Rt,n(x.value.createdAt),1)])]),e("div",Ft,[f(l,{name:"mdi-text",class:"text-gray-600 dark:text-gray-400 mt-1"}),e("div",At,[t[11]||(t[11]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Description",-1)),e("div",It,n(x.value.description),1)])]),M.value.length?(r(),o("div",$t,[t[12]||(t[12]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Ticket Attachments",-1)),e("div",Ct,[(r(!0),o(h,null,A(M.value,(a,d)=>(r(),o("a",{key:d,href:a,target:"_blank",class:"block"},[e("img",{src:a,alt:"ticket attachment",class:"rounded-md border border-gray-200 dark:border-gray-700 max-h-36 w-auto"},null,8,Bt)],8,jt))),128))])])):v("",!0)])]))])),j.value?v("",!0):(r(),o("div",Lt,[f(u,{to:"/dashboard/helpdesk"},{default:fe(()=>t[14]||(t[14]=[e("button",{class:"px-4 py-2 bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-700"}," ‚Üê Back to List ",-1)])),_:1,__:[14]})]))])}}});export{Ht as default};
