import{br as E,bC as y,c1 as p,by as b,bo as u,aW as I}from"./B132AJ_X.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};n.SENTRY_RELEASE={id:"3703708ef9ac1b45e23fc2a6a145a79341d4c60a"}}catch{}})();try{(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new n.Error().stack;s&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[s]="79ca2b00-e44b-4021-a27c-65d3bd19b063",n._sentryDebugIdIdentifier="sentry-dbid-79ca2b00-e44b-4021-a27c-65d3bd19b063")})()}catch{}const D=()=>{const{isLoggedIn:n}=E(),s=I(),o=y("cartData",()=>({items:[],summary:{sub_total:"₹0.00",tax:"₹0.00",discount:"₹0.00",total:"₹0.00",quantity:0,coupon_applied:!1},customer:{}})),c=y("cartLoading",()=>!1),i=p("guest_id"),d=p("guest_token"),l=p("guest_token_expires"),r=()=>!n.value&&i.value&&d.value?{"x-guest-id":i.value,"x-guest-token":d.value}:{};async function v(){const e=l.value&&Date.now()>new Date(l.value).getTime(),a=!i.value||!d.value;if(!n.value&&(e||a))try{const t=await u(`${s.public.apiBase}/cart/guest-credential`,{method:"POST"}),f=(t==null?void 0:t.data)||{};i.value=f.guest_id,d.value=f.guest_token,l.value=f.expires_at}catch(t){console.error("[Cart] Failed to init guest credentials",t)}}async function g(){if(!c.value){c.value=!0;try{await v();const e=await u(`${s.public.apiBase}/cart`,{method:"GET",headers:r()});o.value=(e==null?void 0:e.data)||o.value}catch(e){console.error("[Cart] Fetch error",e)}finally{c.value=!1}}}async function m(e,a=1){try{const t=await u(`${s.public.apiBase}/cart/add/${e}`,{method:"POST",headers:r(),body:{quantity:a}});o.value=(t==null?void 0:t.data)||o.value}catch(t){console.error("[Cart] Add error",t)}}async function h(e,a){try{const t=await u(`${s.public.apiBase}/cart/update/${e}`,{method:"POST",headers:r(),body:{quantity:a}});o.value=(t==null?void 0:t.data)||o.value}catch(t){console.error("[Cart] Update error",t)}}async function w(e){try{const a=await u(`${s.public.apiBase}/cart/remove/${e}`,{method:"DELETE",headers:r()});o.value=(a==null?void 0:a.data)||o.value}catch(a){console.error("[Cart] Remove error",a)}}async function C(e){try{const a=await u(`${s.public.apiBase}/cart/coupon/${e}`,{method:"POST",headers:r()});o.value=(a==null?void 0:a.data)||o.value}catch(a){console.error("[Cart] Coupon error",a)}}const T=b(()=>{var e;return((e=o.value.summary)==null?void 0:e.quantity)||0}),_=b(()=>o.value.items||[]);return{cartData:o,itemCount:T,items:_,fetchCart:g,addToCart:m,updateCartItem:h,removeItem:w,applyCoupon:C,loading:c}};export{D as u};
