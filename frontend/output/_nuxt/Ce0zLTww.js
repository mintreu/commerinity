import{_ as re}from"./CzGapVpC.js";import{b4 as ie,bp as ue,bq as de,br as K,bd as i,ba as me,bs as be,aY as n,b5 as t,aZ as _,bt as W,bh as A,bk as M,bg as O,bl as y,bm as R,b8 as p,be as G,bf as ve,bu as Y,b7 as w,bv as U,bo as z,aW as pe,bw as $,bc as ce,a_ as r,bx as ye}from"./B132AJ_X.js";import{_ as fe}from"./DeG0kbPa.js";import{s as ge}from"./BjZ6Woku.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};m.SENTRY_RELEASE={id:"3703708ef9ac1b45e23fc2a6a145a79341d4c60a"}}catch{}})();try{(function(){var m=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},x=new m.Error().stack;x&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[x]="64124a69-d910-4311-9167-a9f6ccbba0a7",m._sentryDebugIdIdentifier="sentry-dbid-64124a69-d910-4311-9167-a9f6ccbba0a7")})()}catch{}const xe={class:"h-screen w-full bg-gray-100 dark:bg-gray-900 flex items-center justify-center"},he={class:"w-full max-w-md p-6 bg-white dark:bg-gray-800 shadow-lg rounded-lg"},we={class:"text-center mb-6"},ke={class:"flex justify-center mb-6 space-x-6 text-sm"},_e={key:0,class:"text-red-500 text-sm mt-1"},Oe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Te={key:0},Ce={key:0},Ie=["disabled"],Se={key:1},Ve={class:"flex gap-2 mt-2"},Pe=["onUpdate:modelValue","onInput","onKeydown"],Le=["disabled"],Ee={class:"text-xs text-gray-500 text-center mt-2"},Me={key:0},Re={key:0,class:"text-red-500 text-sm mt-1"},Ue={key:1,class:"text-green-600 text-sm mt-3 text-center"},$e={key:1,class:"relative"},Xe=["type"],Be={key:2,class:"text-red-500 text-sm mt-1"},De={class:"flex justify-between text-sm text-gray-700 dark:text-gray-300"},qe={class:"inline-flex items-center"},Ne={class:"inline-flex items-center"},je=["disabled"],Fe={key:0,class:"text-red-500 text-sm text-center mt-1"},Ke={class:"relative"},We=["type"],Ae={class:"flex text-sm text-gray-700 dark:text-gray-300"},Ge={key:0,class:"text-red-500 text-sm text-center mt-1"},Ye={class:"mt-6"},ze={class:"text-center text-sm mt-4"},Z="px-4 py-2 text-blue-600 border-b-2 border-blue-600 font-semibold",H="px-4 py-2 text-gray-500 hover:text-blue-600",et=ie({__name:"login",setup(m){const x=ue(),X=de(),L=pe(),{login:B}=K(),{isLoggedIn:J}=K(),c=i(!1),T=i("mobile"),f=i(!1),E=i(!1),h=i(!1),C=i(!1),I=i(!1),k=i(0),S=i(null),g=i(["","","","","",""]),V=i([]),o=i({}),s=i({mobile:"",email:"",password:"",remember:!1});me(()=>{J.value&&x.push("/dashboard")});function D(l){T.value=l,f.value=E.value=h.value=!1,g.value=["","","","","",""],s.value={mobile:"",email:"",password:"",remember:!1},o.value={},P()}function q(l){const e=l.trim();return/^[6-9]\d{9}$/.test(e)?null:"Enter a valid 10-digit Indian mobile number"}function Q(){k.value=60,S.value=ge(()=>{k.value>0?k.value--:P()},1e3)}function P(){S.value&&clearInterval(S.value),S.value=null}async function N(){if(o.value.mobile=q(s.value.mobile)||"",!o.value.mobile){C.value=!0;try{await z(`${L.public.apiBase}/auth/send-otp`,{method:"POST",body:{type:"mobile",value:s.value.mobile.trim()}}),E.value=!0,Q(),$(()=>{var l;return(l=V.value[0])==null?void 0:l.focus()})}catch{o.value.validated_otp="Failed to send OTP"}finally{C.value=!1}}}function ee(){g.value=["","","","","",""],h.value=!1,N()}async function te(){var e;o.value.validated_otp="";const l=g.value.join("");if(l.length!==6){o.value.validated_otp="Enter 6-digit OTP";return}I.value=!0;try{(e=(await z(`${L.public.apiBase}/auth/verify-otp`,{method:"POST",body:{type:"mobile",value:s.value.mobile.trim(),otp:l}})).data)!=null&&e.valid?(h.value=!0,P()):o.value.validated_otp="Invalid OTP"}catch{o.value.validated_otp="OTP verification failed"}finally{I.value=!1}}async function ae(){var b,v,a,u;o.value={};const l=q(s.value.mobile);if(l){o.value.mobile=l;return}const e={mobile:s.value.mobile.trim(),remember:s.value.remember,validated_otp:h.value};f.value||(e.password=s.value.password);try{await B(e),j()}catch(d){const F=((b=d==null?void 0:d.data)==null?void 0:b.errors)||{};o.value.auth=((v=F.mobile)==null?void 0:v[0])||((a=F.password)==null?void 0:a[0])||((u=d==null?void 0:d.data)==null?void 0:u.message)||"Login failed"}}async function le(){var l,e,b,v;o.value={};try{await B({email:s.value.email.trim(),password:s.value.password,remember:s.value.remember}),j()}catch(a){const u=((l=a==null?void 0:a.data)==null?void 0:l.errors)||{};o.value.auth=((e=u.email)==null?void 0:e[0])||((b=u.password)==null?void 0:b[0])||((v=a==null?void 0:a.data)==null?void 0:v.message)||"Login failed"}}function oe(l){g.value[l].length===1&&l<5&&$(()=>{var e;return(e=V.value[l+1])==null?void 0:e.focus()})}function se(l){g.value[l]===""&&l>0&&$(()=>{var e;return(e=V.value[l-1])==null?void 0:e.focus()})}function j(){let l="/dashboard";if(X.query.ref)try{l=atob(X.query.ref)}catch(e){console.error("Invalid ref param:",e)}x.push(l)}function ne(){window.location.href=`${L.public.webBase}/auth/google/redirect`}return be(P),(l,e)=>{const b=re,v=ce;return r(),n("div",xe,[t("div",he,[t("div",we,[e[12]||(e[12]=t("img",{src:fe,alt:"Logo",class:"mx-auto h-12 mb-2"},null,-1)),e[13]||(e[13]=t("h1",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Welcome to Commernity",-1)),e[14]||(e[14]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Simple. Secure. Seamless Login",-1)),_(b,{to:"/auth/register",class:"mt-4 inline-block text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition-colors underline"},{default:W(()=>e[11]||(e[11]=[w(" Don’t have an account? Register here ")])),_:1,__:[11]})]),t("div",ke,[t("button",{class:A(T.value==="mobile"?Z:H),onClick:e[0]||(e[0]=a=>D("mobile"))},"Mobile Login",2),t("button",{class:A(T.value==="email"?Z:H),onClick:e[1]||(e[1]=a=>D("email"))},"Email Login",2)]),T.value==="mobile"?(r(),n("form",{key:0,onSubmit:M(ae,["prevent"]),class:"space-y-5"},[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Mobile Number",-1)),y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.mobile=a),type:"tel",required:"",placeholder:"+91 9XXXXXXXXX",class:"mt-1 w-full px-4 py-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[R,s.value.mobile]]),o.value.mobile?(r(),n("p",_e,p(o.value.mobile),1)):O("",!0)]),t("div",null,[t("label",Oe,p(f.value?"OTP":"Password"),1),f.value?(r(),n("div",Te,[E.value?(r(),n("div",Se,[h.value?(r(),n("p",Ue,"✅ OTP Verified Successfully!")):(r(),n(G,{key:0},[t("div",Ve,[(r(),n(G,null,ve(6,(a,u)=>y(t("input",{key:u,"onUpdate:modelValue":d=>g.value[u]=d,ref_for:!0,ref:d=>V.value[u]=d,maxlength:"1",inputmode:"numeric",type:"text",class:"w-10 h-10 text-center border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",onInput:d=>oe(u),onKeydown:ye(M(d=>se(u),["prevent"]),["backspace"])},null,40,Pe),[[R,g.value[u]]])),64))]),t("button",{type:"button",onClick:te,class:"w-full mt-3 bg-green-600 text-white py-2 rounded-md hover:bg-green-700 transition",disabled:I.value},p(I.value?"Verifying...":"Verify OTP"),9,Le),t("div",Ee,[k.value>0?(r(),n("span",Me,"Resend OTP in "+p(k.value)+"s",1)):(r(),n("button",{key:1,onClick:ee,class:"text-blue-600 hover:underline",type:"button"},"Resend OTP"))]),o.value.validated_otp?(r(),n("p",Re,p(o.value.validated_otp),1)):O("",!0)],64))])):(r(),n("div",Ce,[t("button",{onClick:N,type:"button",class:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition",disabled:C.value},p(C.value?"Sending OTP...":"Send OTP"),9,Ie)]))])):(r(),n("div",$e,[y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.password=a),type:c.value?"text":"password",required:"",placeholder:"••••••••",class:"mt-1 w-full px-4 py-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white pr-10"},null,8,Xe),[[Y,s.value.password]]),t("button",{type:"button",onClick:e[4]||(e[4]=a=>c.value=!c.value),class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white",tabindex:"-1"},[_(v,{name:c.value?"heroicons:eye-slash":"heroicons:eye",class:"w-5 h-5"},null,8,["name"])])])),o.value.password?(r(),n("p",Be,p(o.value.password),1)):O("",!0)]),t("div",De,[t("label",qe,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>s.value.remember=a),class:"mr-2"},null,512),[[U,s.value.remember]]),e[16]||(e[16]=w(" Remember me "))]),t("label",Ne,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>f.value=a),class:"mr-2"},null,512),[[U,f.value]]),e[17]||(e[17]=w(" Login with OTP "))])]),t("button",{type:"submit",class:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition",disabled:f.value&&!h.value}," Sign In ",8,je),o.value.auth?(r(),n("p",Fe,p(o.value.auth),1)):O("",!0)],32)):(r(),n("form",{key:1,onSubmit:M(le,["prevent"]),class:"space-y-5"},[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email",-1)),y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.email=a),type:"email",required:"",placeholder:"you@example.com",class:"mt-1 w-full px-4 py-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[R,s.value.email]])]),t("div",Ke,[y(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.password=a),type:c.value?"text":"password",required:"",placeholder:"••••••••",class:"mt-1 w-full px-4 py-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white pr-10"},null,8,We),[[Y,s.value.password]]),t("button",{type:"button",onClick:e[9]||(e[9]=a=>c.value=!c.value),class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white",tabindex:"-1"},[_(v,{name:c.value?"heroicons:eye-slash":"heroicons:eye",class:"w-5 h-5"},null,8,["name"])])]),t("div",Ae,[t("label",null,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=a=>s.value.remember=a),class:"mr-2"},null,512),[[U,s.value.remember]]),e[19]||(e[19]=w("Remember me"))])]),e[20]||(e[20]=t("button",{type:"submit",class:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition"}," Sign In ",-1)),o.value.auth?(r(),n("p",Ge,p(o.value.auth),1)):O("",!0)],32)),t("div",Ye,[t("button",{onClick:ne,class:"w-full flex items-center justify-center gap-3 border border-gray-300 dark:border-gray-600 px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition text-sm font-medium text-gray-700 dark:text-gray-300"},[_(v,{name:"logos:google-icon",class:"w-5 h-5"}),e[21]||(e[21]=w(" Continue with Google "))])]),t("p",ze,[_(b,{to:"/auth/forgot-password",class:"text-blue-600 hover:underline"},{default:W(()=>e[22]||(e[22]=[w("Forgot your password?")])),_:1,__:[22]})])])])}}});export{et as default};
