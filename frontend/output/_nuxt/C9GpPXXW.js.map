{"version":3,"file":"C9GpPXXW.js","sources":["../../../../components/account/AvatarUploader.vue"],"sourcesContent":["<template>\r\n  <div class=\"m-2\">\r\n    <!-- Avatar circle -->\r\n    <div class=\"relative w-40 h-40 rounded-full overflow-hidden border-4 border-white shadow-md cursor-pointer group mx-auto\">\r\n      <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          @change=\"onFileChange\"\r\n          class=\"absolute inset-0 opacity-0 z-10 cursor-pointer\"\r\n      />\r\n      <NuxtImg\r\n          :src=\"croppedAvatar || user?.avatar || '/default-avatar.png'\"\r\n          alt=\"Avatar\"\r\n          class=\"w-full h-full object-cover rounded-full\"\r\n      />\r\n      <div class=\"absolute inset-0 bg-black bg-opacity-20 hidden group-hover:flex items-center justify-center text-white font-medium\">\r\n        Change\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal -->\r\n    <div\r\n        v-if=\"showModal\"\r\n        class=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\"\r\n    >\r\n      <div class=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-lg\">\r\n        <h3 class=\"text-lg font-semibold mb-4\">Crop your Avatar</h3>\r\n        <div class=\"relative w-full aspect-square border rounded overflow-hidden bg-gray-100 dark:bg-gray-700\">\r\n          <Cropper\r\n              class=\"cropper\"\r\n              :src=\"image\"\r\n              :stencil-component=\"CircleStencil\"\r\n              :stencil-props=\"{ aspectRatio: 1 }\"\r\n              @change=\"onCrop\"\r\n          />\r\n        </div>\r\n        <div class=\"flex justify-end gap-3 mt-4\">\r\n          <button class=\"btn-secondary\" @click=\"cancel\">Cancel</button>\r\n          <button\r\n              class=\"btn-primary\"\r\n              @click=\"saveAvatar\"\r\n              :disabled=\"form.processing\"\r\n          >\r\n            {{ form.processing ? 'Saving...' : 'Save' }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue'\r\nimport { Cropper, CircleStencil } from 'vue-advanced-cropper'\r\nimport 'vue-advanced-cropper/dist/style.css'\r\nimport { useSanctum, useSanctumForm,useRuntimeConfig } from '#imports'\r\n\r\nconst { refreshUser, user } = useSanctum()\r\nconst config = useRuntimeConfig()\r\n\r\nconst image = ref<string | null>(null)\r\nconst croppedAvatar = ref<string | null>(null)\r\nconst cropResult = ref<any>(null)\r\nconst showModal = ref(false)\r\n\r\nconst toast = useToast()\r\n\r\nconst form = useSanctumForm('put', `${config.public.apiBase}/account/avatar`, {\r\n  avatar: null as File | null,\r\n})\r\n\r\nfunction onFileChange(event: Event) {\r\n  const file = (event.target as HTMLInputElement)?.files?.[0]\r\n  if (file) {\r\n    const reader = new FileReader()\r\n    reader.onload = (e) => {\r\n      image.value = e.target?.result as string\r\n      showModal.value = true\r\n    }\r\n    reader.readAsDataURL(file)\r\n  }\r\n}\r\n\r\nfunction onCrop({ canvas }: any) {\r\n  cropResult.value = canvas\r\n}\r\n\r\nfunction cancel() {\r\n  image.value = null\r\n  showModal.value = false\r\n  cropResult.value = null\r\n}\r\n\r\nasync function saveAvatar() {\r\n  if (!cropResult.value) return\r\n\r\n  const blob = await new Promise<Blob>((resolve) =>\r\n      cropResult.value.toBlob(resolve, 'image/png')\r\n  )\r\n\r\n  form.avatar = new File([blob], 'avatar.png', { type: 'image/png' })\r\n\r\n  try {\r\n    await form.submit()\r\n    croppedAvatar.value = cropResult.value.toDataURL()\r\n    refreshUser()\r\n    cancel()\r\n  } catch (e) {\r\n    console.error('Upload failed:', e)\r\n    toast.error({ title: 'Error!', message: 'Something went wrong.' })\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.btn-primary {\r\n  @apply px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition disabled:opacity-50;\r\n}\r\n.btn-secondary {\r\n  @apply px-6 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 transition;\r\n}\r\n.cropper {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n</style>\r\n"],"names":["refreshUser","user","useSanctum","config","useRuntimeConfig","image","ref","croppedAvatar","cropResult","showModal","toast","useToast","form","useSanctumForm","onFileChange","event","file","_b","_a","reader","e","onCrop","canvas","cancel","saveAvatar","blob","resolve","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_NuxtImg","_unref","_cache","_hoisted_3","_hoisted_4","_hoisted_5","Cropper","CircleStencil","_hoisted_6","_toDisplayString","_hoisted_7"],"mappings":"qxCAyDA,KAAM,CAAE,YAAAA,EAAa,KAAAC,CAAA,EAASC,EAAA,EACxBC,EAASC,EAAA,EAETC,EAAQC,EAAmB,IAAI,EAC/BC,EAAgBD,EAAmB,IAAI,EACvCE,EAAaF,EAAS,IAAI,EAC1BG,EAAYH,EAAI,EAAK,EAErBI,EAAQC,EAAA,EAERC,EAAOC,EAAe,MAAO,GAAGV,EAAO,OAAO,OAAO,kBAAmB,CAC5E,OAAQ,IAAA,CACT,EAED,SAASW,EAAaC,EAAc,SAClC,MAAMC,GAAQC,GAAAC,EAAAH,EAAM,SAAN,YAAAG,EAAmC,QAAnC,YAAAD,EAA2C,GACzD,GAAID,EAAM,CACR,MAAMG,EAAS,IAAI,WACnBA,EAAO,OAAUC,GAAM,OACrBf,EAAM,OAAQa,EAAAE,EAAE,SAAF,YAAAF,EAAU,OACxBT,EAAU,MAAQ,EACpB,EACAU,EAAO,cAAcH,CAAI,CAC3B,CACF,CAEA,SAASK,EAAO,CAAE,OAAAC,GAAe,CAC/Bd,EAAW,MAAQc,CACrB,CAEA,SAASC,GAAS,CAChBlB,EAAM,MAAQ,KACdI,EAAU,MAAQ,GAClBD,EAAW,MAAQ,IACrB,CAEA,eAAegB,GAAa,CAC1B,GAAI,CAAChB,EAAW,MAAO,OAEvB,MAAMiB,EAAO,MAAM,IAAI,QAAeC,GAClClB,EAAW,MAAM,OAAOkB,EAAS,WAAW,CAAA,EAGhDd,EAAK,OAAS,IAAI,KAAK,CAACa,CAAI,EAAG,aAAc,CAAE,KAAM,YAAa,EAElE,GAAI,CACF,MAAMb,EAAK,OAAA,EACXL,EAAc,MAAQC,EAAW,MAAM,UAAA,EACvCR,EAAA,EACAuB,EAAA,CACF,OAAS,EAAG,CACV,QAAQ,MAAM,iBAAkB,CAAC,EACjCb,EAAM,MAAM,CAAE,MAAO,SAAU,QAAS,wBAAyB,CACnE,CACF,+BA9GE,OAAAiB,EAAA,EAAAC,EA+CM,MA/CNC,EA+CM,CA7CJC,EAeM,MAfNC,EAeM,CAdJD,EAKE,QAAA,CAJE,KAAK,OACL,OAAO,UACN,SAAQhB,EACT,MAAM,gDAAA,WAEVkB,EAIEC,EAAA,CAHG,IAAK1B,EAAA,SAAiB2B,EAAAA,EAAAjC,CAAA,IAAAiC,YAAAA,EAAM,SAAM,sBACnC,IAAI,SACJ,MAAM,yCAAA,kBAEVC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAL,EAEM,MAAA,CAFD,MAAM,sHAAqH,WAEhI,EAAA,EAAA,GAKQrB,EAAA,OADVkB,EAAA,EAAAC,EA0BM,MA1BNQ,EA0BM,CAtBJN,EAqBM,MArBNO,EAqBM,CApBJF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAL,EAA4D,KAAA,CAAxD,MAAM,4BAAA,EAA6B,mBAAgB,EAAA,GACvDA,EAQM,MARNQ,EAQM,CAPJN,EAMEE,EAAAK,CAAA,EAAA,CALE,MAAM,UACL,IAAKlC,EAAA,MACL,oBAAmB6B,EAAAM,CAAA,EACnB,gBAAe,CAAA,YAAA,CAAA,EACf,SAAQnB,CAAA,wCAGfS,EASM,MATNW,EASM,CARJX,EAA6D,SAAA,CAArD,MAAM,gBAAiB,QAAOP,CAAA,EAAQ,QAAM,EACpDO,EAMS,SAAA,CALL,MAAM,cACL,QAAON,EACP,SAAUU,EAAAtB,CAAA,EAAK,UAAA,EAEf8B,EAAAR,EAAAtB,CAAA,EAAK,WAAU,YAAA,MAAA,EAAA,EAAA+B,CAAA,CAAA"}